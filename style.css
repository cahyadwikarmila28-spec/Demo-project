/**
 * Portal Informasi Geografis Karanglewas Kidul
 * Script Utama - Menangani Navigasi, Menu Mobile, dan Peta
 */

document.addEventListener('DOMContentLoaded', () => {
    console.log('WebGIS Karanglewas Kidul Dimuat');

    // --- 1. INISIALISASI MENU MOBILE ---
    const initMobileMenu = () => {
        const menuBtn = document.querySelector('#mobile-menu');
        const navLinksContainer = document.querySelector('.nav-links');
        const navLinks = document.querySelectorAll('.nav-link');

        if (menuBtn && navLinksContainer) {
            menuBtn.addEventListener('click', () => {
                // Toggle class untuk animasi ikon (menjadi X)
                menuBtn.classList.toggle('is-active');
                // Toggle class untuk menampilkan daftar menu di mobile
                navLinksContainer.classList.toggle('mobile-active');
            });

            // Tutup menu secara otomatis jika salah satu link diklik
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    menuBtn.classList.remove('is-active');
                    navLinksContainer.classList.remove('mobile-active');
                });
            });
        }
    };

    // --- 2. FUNGSI NAVIGASI SECTION ---
    // Menggunakan window agar fungsi bisa diakses dari atribut onclick di HTML
    window.showSection = (sectionId, event) => {
        if (event) event.preventDefault();

        const sections = document.querySelectorAll('.content-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const hero = document.querySelector('.hero');
        const stats = document.querySelector('.stats-container');

        // Logic tampilan: Hero & Stats hanya muncul di Beranda
        const isHomePage = (sectionId === 'beranda');
        if (hero) hero.style.display = isHomePage ? 'block' : 'none';
        if (stats) stats.style.display = isHomePage ? 'block' : 'none';

        // Sembunyikan semua section, lalu munculkan yang dipilih
        sections.forEach(s => s.classList.remove('active'));
        const activeSection = document.getElementById(sectionId);
        if (activeSection) {
            activeSection.classList.add('active');
            // Scroll otomatis ke atas saat pindah menu
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Update status 'active' pada tombol navigasi
        navLinks.forEach(l => l.classList.remove('active'));
        const currentLink = document.querySelector(`.nav-link[href="#${sectionId}"]`);
        if (currentLink) currentLink.classList.add('active');
    };

    // --- 3. FUNGSI PEMILIHAN DESA (PETA KECAMATAN) ---
    window.selectVillage = (villageId) => {
        const iframe = document.getElementById('kecamatan-map');
        const title = document.getElementById('village-info-title');
        const content = document.getElementById('village-info-content');
        const buttons = document.querySelectorAll('.village-btn');

        // Reset semua tombol, beri class active pada yang diklik
        buttons.forEach(btn => btn.classList.remove('active'));
        event.currentTarget.classList.add('active');

        // Database sederhana konten informasi desa
        const villageData = {
            'karanglewas-kidul': {
                title: 'Informasi Desa Karanglewas Kidul',
                content: 'Desa Karanglewas Kidul adalah desa terbesar di Kecamatan Karanglewas dengan luas 13,4 kmÂ². Memiliki fasilitas pendidikan, kesehatan, dan olahraga yang lengkap.',
                mapUrl: 'Peta_Kecamatan/Kecamatan.html#karanglewas-kidul' // Sesuaikan jika ada file spesifik
            },
            'kediri': {
                title: 'Informasi Desa Kediri',
                content: 'Desa Kediri terletak di utara Karanglewas Kidul. Dikenal dengan potensi pertanian padi yang sangat produktif dan sistem irigasi teknis.',
                mapUrl: 'Peta_Kecamatan/Kecamatan.html#kediri'
            },
            'pangebatan': {
                title: 'Informasi Desa Pangebatan',
                content: 'Desa Pangebatan berada di sisi timur. Masyarakatnya dikenal religius dengan keberadaan beberapa pondok pesantren besar.',
                mapUrl: 'Peta_Kecamatan/Kecamatan.html#pangebatan'
            },
            'tamansari': {
                title: 'Informasi Desa Tamansari',
                content: 'Desa Tamansari berada di sisi barat dengan topografi yang mendukung sektor perkebunan dan udara yang relatif sejuk.',
                mapUrl: 'Peta_Kecamatan/Kecamatan.html#tamansari'
            }
        };

        // Update Teks Informasi
        if (villageData[villageId]) {
            title.innerHTML = `<i class="fas fa-info-circle"></i> ${villageData[villageId].title}`;
            content.innerText = villageData[villageId].content;
            
            // Opsional: Ganti URL iframe jika Anda punya file peta per desa
            // iframe.src = villageData[villageId].mapUrl;
        }
    };

    // --- 4. MENJALANKAN FUNGSI ---
    initMobileMenu();

    // Set tampilan awal secara default ke Beranda
    showSection('beranda');
});
